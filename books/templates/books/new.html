{% extends 'base.html' %}
{% load static %}

{% block title%}Add a New Book | {{ block.super}}{% endblock %}
{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/map-style.css' %}">
<link rel="stylesheet" href="{% static 'css/leaflet-search.css' %}">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
crossorigin=""/>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
crossorigin=""></script>

<script src='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css' rel='stylesheet' />

{% endblock head_extra %}
{% block content %}

<div class="container">
    <h1>New Book</h1>
    <p>Add a new book here:</p>
    <form method="POST" action="{% url 'books:new' %}">
        {% csrf_token %}
        <input type="text" name="title" required class="form-control" placeholder="enter book title"/>
        <div class="row">
            <div class="col-md-2">
            <input type="text" name="lon" id="id_lon" class="form-control" placeholder="longitute" required />
        </div>
        <div class="col-md-2">
            <input type="text" name="lat" id="id_lat" class="form-control" placeholder="latitude" required />
        </div>
        <div class="col-md-8">
            <p class="form-control">enter longitute and latitude or select from map</p>
        </div>
    </div>
        <div id="mapid"></div>
        <script>
        var mymap = new L.Map('mapid', {zoom: 2, center: new L.latLng([40,13]) });	//set center from first location
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: 'pk.eyJ1IjoiYnJpYW5jYWZmZXkiLCJhIjoiY2pkczJycjl5MmhqbTMzbzQ3bHJuaHA3aiJ9.cvRYYPNjQJVpFjdUcmIHzA'
        }).addTo(mymap);

        var markersLayer = new L.LayerGroup();
        mymap.addLayer(markersLayer);

        function addMarker(e){


            markersLayer.clearLayers();

            var marker = new L.marker(e.latlng);
            markersLayer.addLayer(marker);
            $("#id_lon").val(e.latlng["lat"]);
            $("#id_lat").val(e.latlng["lng"]);


            }
        mymap.on('click', function(e){
            console.log('clicked map')
            addMarker(e);
        });





        </script>

        <input type="submit" class="btn btn-success"></input>
    </form>
</div>

{% endblock %}